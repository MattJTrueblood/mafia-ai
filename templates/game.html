<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia AI - Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Mafia AI Game</h1>
        <div class="main-content">
            <div class="left-column">
                <div id="game-info">
                    <p><strong>Game ID:</strong> <span id="game-id">{{ game_id }}</span></p>
                    <p><strong>Phase:</strong> <span id="phase">{{ game_state.phase }}</span> | <strong>Day:</strong> <span id="day">{{ game_state.day_number }}</span></p>
                    <p id="game-status" class="status"></p>
                </div>

                <div id="controls">
                    <button id="start-btn" class="btn-primary">Start Game</button>
                    <button id="pause-btn" class="btn-pause" disabled>Pause</button>
                    <button id="reveal-btn" class="btn-reveal" style="display: none;">Reveal All</button>
                </div>

                <!-- Human Player Controls -->
                <div id="human-controls" style="display: none;">
                    <!-- Interrupt Button (shown during AI discussion) -->
                    <div id="interrupt-control" style="display: none;">
                        <button id="interrupt-btn" class="btn-interrupt">I Want to Speak</button>
                        <span id="interrupt-status"></span>
                    </div>

                    <!-- Trashtalk Controls (shown during postgame trashtalk) -->
                    <div id="trashtalk-control" style="display: none;">
                        <button id="trashtalk-interrupt-btn" class="btn-interrupt">I Want to Speak</button>
                        <button id="end-trashtalk-btn" class="btn-secondary">End Trashtalk</button>
                        <span id="trashtalk-status"></span>
                    </div>

                    <!-- Discussion Input -->
                    <div id="discussion-input" style="display: none;">
                        <h4>Your Turn to Speak</h4>
                        <textarea id="message-text" placeholder="Type your message..." rows="3"></textarea>
                        <div class="input-actions">
                            <button id="send-message" class="btn-primary">Send</button>
                            <button id="pass-turn" class="btn-secondary">Pass</button>
                        </div>
                    </div>

                    <!-- Vote Input -->
                    <div id="vote-input" style="display: none;">
                        <h4>Cast Your Vote</h4>
                        <select id="vote-target">
                            <option value="abstain">Abstain</option>
                        </select>
                        <textarea id="vote-explanation" placeholder="Explanation (optional)..." rows="2"></textarea>
                        <button id="cast-vote" class="btn-primary">Cast Vote</button>
                    </div>

                    <!-- Role Action Input -->
                    <div id="role-input" style="display: none;">
                        <h4 id="role-action-label">Choose Target</h4>
                        <select id="role-target"></select>
                        <button id="submit-action" class="btn-primary">Confirm</button>
                    </div>

                    <!-- MVP Vote Input -->
                    <div id="mvp-vote-input" style="display: none;">
                        <h4>Vote for MVP</h4>
                        <select id="mvp-target"></select>
                        <textarea id="mvp-reason" placeholder="Why? (optional)..." rows="2"></textarea>
                        <button id="mvp-vote-btn" class="btn-primary" onclick="handleMvpVote()">Cast MVP Vote</button>
                    </div>
                </div>

                <div id="players-section">
                    <h2>Players</h2>
                    <div id="players-list"></div>
                </div>
            </div>

            <div class="right-column">
                <div id="event-log-section">
                    <h2>Game Events</h2>
                    <div id="event-log"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Context Modal -->
    <div id="context-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>LLM Context - <span id="modal-player-name"></span></h3>
                <button class="modal-close" onclick="closeContextModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="context-meta">
                    <span>Action: <strong id="modal-action-type"></strong></span>
                    <span>Phase: <strong id="modal-phase"></strong></span>
                    <span>Day: <strong id="modal-day"></strong></span>
                    <span>Time: <strong id="modal-timestamp"></strong></span>
                    <span>Est. Tokens: <strong id="modal-tokens"></strong></span>
                </div>
                <div class="context-section">
                    <h4 id="modal-section-title">Prompt</h4>
                    <div id="modal-content-text" class="context-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-copy" onclick="copyContext()">Copy to Clipboard</button>
                <button class="btn-secondary" onclick="closeContextModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Scratchpad Modal -->
    <div id="scratchpad-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Scratchpad - <span id="scratchpad-player-name"></span></h3>
                <button class="modal-close" onclick="closeScratchpadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="context-meta">
                    <span>Day: <strong id="scratchpad-day"></strong></span>
                    <span>Phase: <strong id="scratchpad-phase"></strong></span>
                    <span>Timing: <strong id="scratchpad-timing"></strong></span>
                    <span>Time: <strong id="scratchpad-timestamp"></strong></span>
                </div>
                <div class="context-section">
                    <h4>Strategic Notes</h4>
                    <div id="scratchpad-note" class="context-content" style="white-space: pre-wrap;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeScratchpadModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script>
        const gameId = '{{ game_id }}';
        initializeGame(gameId);
    </script>
</body>
</html>

